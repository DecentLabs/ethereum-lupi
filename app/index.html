<!DOCTYPE html>
<html>
<head>
    <title>Million Number Game</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/icon?family=Material+Icons">

    <script src="./app.js"></script>
    <!-- FIXME: webpack doesn't deploy these -->
    <link rel="apple-touch-icon" sizes="57x57" href="./apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="./android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="./favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
    <link rel="manifest" href="./manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="./ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="mainDiv" class="container">

    <div class='page-header' id='banner'>
        <h1>
            Million Number Game
            <small class="pull-right">Guess the smallest unique number</small>
        </h1>
    </div>

    <div id="status"></div>

    <div class="row">

        <div class="col-xs-12 col-md-8">

            <div id="guessDiv" style="display:none">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2 class="panel-title">Pick the smallest unique number that no one else picks.</h2>
                    </div>
                    <div class="panel-body">
                        <h3>Winnable amount: <strong><span id="winnablePotAmount">?</span> ETH</strong></h3>
                        <div class="form-group">
                            <label for="guess" class="control-label">Your guess</label>
                            <input type="text" class="form-control input-lg" id="guess" style="width: 4em">
                            <span class="help-block">Enter a positive integer</span>
                        </div>
                        <h4><span id="ticketCount"></span> guesses placed from <span id="ticketCountLimit1">?</span></h4>
                        <p class="help-block">Ticket cost: <span id="requiredBetAmount">?</span> ETH</p>
                        <button id="placeBetButton" onclick="App.placeBet()" class="btn btn-raised btn-primary">Submit my guess</button>
                    </div>
                </div>
            </div> <!-- guessDiv -->

            <div id="revealOverDiv" style="display:none">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2 class="panel-title">Reveal period over</h2>
                    </div>
                    <div class="panel-body">
                        <p>Reveal time is over but <span id="unRevealedCount">?</span> bets are not revealed yet.</p>
                        <p>You can close the reveal period by initiating Winner declaration.</p>
                        <p><span class="hint">Tickets still can be revealed until winner declaration</span></p>
                        <p><button id="send" onclick="App.declareWinner()" class="btn btn-default">Close reveal period and Declare winner</button>
                    </div>
                </div>
            </div> <!-- revealOverDiv -->

            <div id="revealDiv" style="display:none">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h2 class="panel-title">All bets received, start revealing</h2>
                    </div>
                    <div class="panel-body">

                        <div id="revealFirstDiv">
                            <p>Maximum number of bets placed. Start the reveal period by revealing a guess.</p>
                            <p>Reveal period will last <span id="revealPeriodLength1">?</span></p>
                        </div> <!-- firstRevealDiv -->
                        <div id="revealRunningDiv">
                            <h2>Reveal ticket</h2>
                            <br>Reveal period end: <span id="revealPeriodEnds">?</span>
                        </div> <!-- additionalRevealDiv -->
                        <br><span id="revealedCount">?</span> revealed from <span id="ticketCountLimit2">?</span>
                        <div id="ticketsToRevealDiv">
                        <br><strong>Your tickets </strong><br>
                        <div id="ticketsListDiv">
                        </div>  <!-- ticketsListDiv -->
                        </div> <!-- ticketsToRevealDiv -->
                        <div id="revealManualDiv" style="display:none">
                            <h4>Ticket info to reveal:</h4>
                            <label for="accountInput">Account:</label><input type="text" id="accountInput" style="width: auto;" size="66" maxlength="42" placeholder="0x0...."></input>
                            <br><label for="ticketId">Ticket id:</label><input type="text" id="ticketId" style="width: auto;" size="10" placeholder="ticket id"></input>
                            <br><label for="salt">Secret key:</label><input type="text" id="salt" style="width: auto;" size="66" maxlength="66" placeholder="0x0...."></input>
                            <br><label for="revealGuess">Guess:</label><input type="text" id="revealGuess" style="width: auto;" size="10" placeholder=""></input>
                            <br><br><button id="send" onclick="App.manualRevealBet()" class="btn btn-primary">Reveal ticket</button>
                        </div> <!-- revealManualDiv -->
                        <br><a id="toggleManualRevealText" href="javascript:App.toggleManualReveal();">Enter ticket info manually >></a>
                        <br>
                    </div>
                </div>
            </div> <!-- revealDiv -->

            <div id="revealStartOnlyDiv" style="display:none">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2 class="panel-title">Start reveal period</h2>
                    </div>
                    <div class="panel-body">
                        Start the reveal period withouth a reveal (anybody can initiate it).
                        <p>Reveal period will be <span id="revealPeriodLength2">?</span></p>
                        <button id="send" onclick="App.startRevealing()" class="btn btn-default">Start revealing</button>
                    </div>
                </div>
            </div> <!-- revealStartDiv -->

            <div id="revealOverAllRevealedDiv" style="display:none">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2 class="panel-title">Reveal period over</h2>
                    </div>
                    <div class="panel-body">
                        <p>All bets revealed.</p>
                        <p>Let's declare the winner! (anybody can do it :) )</p>
                        <button id="send" onclick="App.declareWinner()" class="btn btn-default">Declare winner</button>
                    </div>
                </div>
            </div> <!-- revealOverDiv -->

            <div id="wonDiv" style="display:none">
                <h2>Someone won the game</h2>
                <br>The winner is <span id="winningAddress"></span>
                <br>with the number: <span id="winningNumber"></span>
                <div id="payWinnerDiv" style="display:none">
                    <br>Request payout to winner (anybody can initiate it :) )
                    <br><br><button id="send" onclick="App.payWinner()">Pay winner</button>
                    <br>
                </div> <!-- payWinnerdiv -->
                <div id="winnerAlreadyPayedDiv" style="display:none">
                    <br>The winner has been already payed
                </div> <!-- winnerPayedDiv -->
                <hr>
            </div> <!-- wonDiv -->

            <div id="tiedDiv" style="display:none">
                <h2>Game is tied</h2>
                <br>It's a tie: no unique guess was placed.
                <br>All bets (less fees) can be refunded to players by request.
                <div id="refundPlayerDiv" style="display:inline">
                    <br><label for="refundTicketId">Ticket id:</label><input type="number" id="refundTicketId" placeholder="ticket Id"></input>
                    <br><br><button id="send" onclick="App.refund()">Refund ticket</button>
                </div>  <!-- refundPlayerDiv -->
                <!-- TODO:  <div id="playerAlreadyRefundedDiv" style="display:none">
                  <br>All your tickets have been refunded already
                </div> --> <!-- playerAlreadyRefundedDiv -->
                <br>
                <hr>
            </div> <!-- tiedDiv -->

            <a id="subscribeAlertText" href="javascript:App.toggleSubscribeAlert();">Get notified when you need to reveal >></a>
            <div id="subscribeAlertDiv" style="display: none">
                <h2>Subscribe alerts</h2>
                <br>Get notified when a reveal period or a new games starts<br>
                <br><label for="emailInput">Email:</label><input type="text" id="emailInput" style="width: auto;" size="35" placeholder="your@email.com"></input>
                <br><br><button id="subscribeButton" onclick="App.subscribeAlert()">Notify me</button>
                <br><span class="hint">Note: It's an experimental feature, no guarantee that alerts will be sent out.</span>
                <hr>
            </div> <!-- subscribeAlertDiv -->
            <hr>
            <div id="backupDiv" style="display: none">
                <br><a href='#self' onclick='App.exportTickets(); return false;'>Download your tickets</a> for backup
            </div> <!--backupDiv -->
            <div id="restoreDiv" style="display: block">
                <br>Restore tickets: <input type="file" onchange='App.importTickets(this)' accept=".json"></a>
            </div> <!-- restoreDiv -->
            <hr>
            <br><a href="https://github.com/DecentLabs/ethereum-lupi/blob/master/README.md" target="_blank">Learn more about the game</a>

            <br><br><a id="toggleDebugInfoText" href="javascript:App.toggleDebugInfo();">Show debug info >></a>

            <div id="massageDiv" style="display:none">

                <br><br><span class="hint"><strong>Hint:</strong> open the browser developer console to view any errors and warnings.</span>

                <h2>Debug massage</h2>
                <br>Your account: <span id="accountAddress">?</span>
                <br>Your a/c balance: <span id="accountBalance">?</span> ether
                <br>LupiManager address: <span id="lupiManagerAddress">?</span>
                <br>LupiManager owner: <span id="lupiManagerOwner">?</span>
                <br>Games count: <span id="gamesCount">?</span>
                <br>Selected game idx: <span id="gameIdx">?</span>
                <br>Game contract address: <span id="contractAddress">?</span>
                <br>Game contract owner: <span id="contractOwner">?</span>
                <br>Game contract balance: <span id="contractBalance">?</span>
                <br>
                <br><span id="roundInfoDebug"></span>
                <div id="createGameDiv">
                    <h3>Create new game</h3>
                    <br>only by owner<br>
                    <br><label for="requiredBetAmountInput">Bet amount:</label><input type="number" id="requiredBetAmountInput" style="width: auto;" size="10" placeholder=""></input> ether
                    <br><label for="ticketCountLimitInput">Ticket limit:</label><input type="number" id="ticketCountLimitInput" style="width: auto;" size="10" placeholder=""></input>
                    <br><label for="revealPeriodLengthInput">Reveal period:</label><input type="number" id="revealPeriodLengthInput" style="width: auto;" size="10" placeholder=""></input> minutes
                    <br><label for="feePtInput">fee:</label><input type="number" id="feePtInput" placeholder="" style="width: auto;" size="5" maxlength="5"></input> %
                    <br><br><button id="send" onclick="App.createGame()">Create new game</button>
                    <hr>
                </div> <!-- createGameDiv -->
            </div> <!-- massageDiv -->
        </div>

        <div class="col-xs-12 col-md-4">
            <div id="connectHelpDiv" style="display:none">
                <div class='well infobox'>

                    You need an <a href="https://www.ethereum.org/" target="_blank">Ethereum</a> capable browser to play the game.
                    <br>The game is only on Ropsten test network yet.
                    <br>
                    <ul>
                        <li>Install <a href="https://metamask.io/" target="_blank">Metamask Chrome plugin</a> and select Ropsten testnet or</li>
                        <li>Install <a href="https://github.com/ethereum/mist/releases" target="_blank">Mist browser</a> and select Develop/Network/Testnet</li>
                    </ul>
                    You will also need some test ether.
                    <br>You can mine test ether or just ask for some from us: lupi@decent.org
                </div>
            </div> <!-- connectHelpDiv -->
        </div>

    </div> <!-- mainDiv -->
</body>
</html>
